<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Générateur d'affiche personnalisée</title>
<style>
  body { font-family: Arial, sans-serif; text-align: center; }
  canvas { border: 1px solid #ccc; margin-top: 10px; cursor: grab; }
  #controls { margin-top: 10px; }
</style>
</head>
<body>
<h1>Générateur d'affiche personnalisée</h1>
<p>Ajoutez votre photo puis déplacez-la sur l'affiche. Utilisez la barre pour ajuster la taille et téléchargez l'image finale.</p>
<input type="file" id="photoInput" accept="image/*"><br>
<label for="scaleRange">Zoom photo :</label>
<input type="range" id="scaleRange" min="0.1" max="2" step="0.01" value="1">
<div id="controls">
  <button id="downloadBtn">Télécharger</button>
</div>
<canvas id="posterCanvas" width="600" height="800"></canvas>
<script>
const canvas = document.getElementById('posterCanvas');
const ctx = canvas.getContext('2d');
const basePoster = new Image();
basePoster.src = 'poster.png';
let userImg = new Image();
let imgX = 200, imgY = 200; // position initiale
let imgScale = 1;
let dragging = false;
let offsetX = 0, offsetY = 0;

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  if (basePoster.complete) {
    ctx.drawImage(basePoster, 0, 0, canvas.width, canvas.height);
  }
  if (userImg.complete && userImg.src) {
    const w = userImg.width * imgScale;
    const h = userImg.height * imgScale;
    ctx.drawImage(userImg, imgX, imgY, w, h);
  }
}

basePoster.onload = draw;

document.getElementById('photoInput').addEventListener('change', (e) => {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = (ev) => {
    userImg = new Image();
    userImg.onload = draw;
    userImg.src = ev.target.result;
  };
  reader.readAsDataURL(file);
});

canvas.addEventListener('mousedown', (e) => {
  if (!userImg.src) return;
  const rect = canvas.getBoundingClientRect();
  const x = e.clientX - rect.left;
  const y = e.clientY - rect.top;
  const w = userImg.width * imgScale;
  const h = userImg.height * imgScale;
  if (x >= imgX && x <= imgX + w && y >= imgY && y <= imgY + h) {
    dragging = true;
    offsetX = x - imgX;
    offsetY = y - imgY;
    canvas.style.cursor = 'grabbing';
  }
});

canvas.addEventListener('mousemove', (e) => {
  if (!dragging) return;
  const rect = canvas.getBoundingClientRect();
  imgX = e.clientX - rect.left - offsetX;
  imgY = e.clientY - rect.top - offsetY;
  draw();
});

canvas.addEventListener('mouseup', () => {
  dragging = false;
  canvas.style.cursor = 'grab';
});
canvas.addEventListener('mouseleave', () => { dragging = false; canvas.style.cursor = 'grab'; });

document.getElementById('scaleRange').addEventListener('input', (e) => {
  imgScale = parseFloat(e.target.value);
  draw();
});

// Télécharger l'image
function downloadCanvas() {
  const link = document.createElement('a');
  link.download = 'affiche.png';
  link.href = canvas.toDataURL('image/png');
  link.click();
}
document.getElementById('downloadBtn').addEventListener('click', downloadCanvas);
</script>
</body>
</html>
